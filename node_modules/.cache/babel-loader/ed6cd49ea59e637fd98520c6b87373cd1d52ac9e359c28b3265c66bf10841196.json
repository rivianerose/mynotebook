{"ast":null,"code":"import _toConsumableArray from\"C:/Users/Riviane/Desktop/projectpt/Course-React-PT/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _regeneratorRuntime from\"C:/Users/Riviane/Desktop/projectpt/Course-React-PT/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/Riviane/Desktop/projectpt/Course-React-PT/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/Riviane/Desktop/projectpt/Course-React-PT/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState}from'react';import{addDoc,collection,query,where,getDocs,doc,deleteDoc}from'firebase/firestore';import{db,auth}from'../config/firebase';import{useAuthState}from'react-firebase-hooks/auth';import{useEffect}from'react';import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export var Post=function Post(props){var post=props.post;var _useAuthState=useAuthState(auth),_useAuthState2=_slicedToArray(_useAuthState,1),user=_useAuthState2[0];var _useState=useState(null),_useState2=_slicedToArray(_useState,2),likes=_useState2[0],setLikes=_useState2[1];var likesRef=collection(db,\"likes\");var likesDoc=query(likesRef,where(\"postId\",\"==\",post.id));var getLikes=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return getDocs(likesDoc);case 2:data=_context.sent;setLikes(data.docs.map(function(doc){return{userId:doc.data().userId,likeId:doc.id};}));case 4:case\"end\":return _context.stop();}},_callee);}));return function getLikes(){return _ref.apply(this,arguments);};}();var addLike=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var newDoc;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return addDoc(likesRef,{userId:user===null||user===void 0?void 0:user.uid,postId:post.id});case 3:newDoc=_context2.sent;if(user){setLikes(function(prev){return prev?[].concat(_toConsumableArray(prev),[{userId:user.uid,likeId:newDoc.id}]):[{userId:user.uid,likeId:newDoc.id}];});};_context2.next=11;break;case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](0);console.log(_context2.t0);case 11:case\"end\":return _context2.stop();}},_callee2,null,[[0,8]]);}));return function addLike(){return _ref2.apply(this,arguments);};}();var removeLike=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(){var likeToDeleteQuery,likeToDeleteData,likeId,likeToDelete;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:_context3.prev=0;likeToDeleteQuery=query(likesRef,where(\"postId\",\"==\",post.id),where(\"userId\",\"==\",user===null||user===void 0?void 0:user.uid));_context3.next=4;return getDocs(likeToDeleteQuery);case 4:likeToDeleteData=_context3.sent;likeId=likeToDeleteData.docs[0].id;likeToDelete=doc(db,\"likes\",likeId);_context3.next=9;return deleteDoc(likeToDelete);case 9:if(user){setLikes(function(prev){return prev&&prev.filter(function(like){return like.likeId!==likeId;});});};_context3.next=16;break;case 13:_context3.prev=13;_context3.t0=_context3[\"catch\"](0);console.log(_context3.t0);case 16:case\"end\":return _context3.stop();}},_callee3,null,[[0,13]]);}));return function removeLike(){return _ref3.apply(this,arguments);};}();var hasUserLiked=likes===null||likes===void 0?void 0:likes.find(function(like){return like.userId===(user===null||user===void 0?void 0:user.uid);});useEffect(function(){getLikes();},[]);return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"title\",children:/*#__PURE__*/_jsxs(\"h1\",{children:[\" \",post.title,\" \"]})}),/*#__PURE__*/_jsx(\"div\",{className:\"body\",children:/*#__PURE__*/_jsxs(\"p\",{children:[\" \",post.description,\" \"]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"footer\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[\" @\",post.username]}),/*#__PURE__*/_jsxs(\"button\",{onClick:hasUserLiked?removeLike:addLike,children:[\" \",hasUserLiked?/*#__PURE__*/_jsx(_Fragment,{children:\"\\uD83D\\uDC4E\"}):/*#__PURE__*/_jsx(_Fragment,{children:\"\\uD83D\\uDC4D \"})]}),likes&&/*#__PURE__*/_jsxs(\"p\",{children:[\" Likes : \",likes===null||likes===void 0?void 0:likes.length,\" \"]})]})]});};","map":{"version":3,"names":["React","useState","addDoc","collection","query","where","getDocs","doc","deleteDoc","db","auth","useAuthState","useEffect","jsxs","_jsxs","jsx","_jsx","Fragment","_Fragment","Post","props","post","_useAuthState","_useAuthState2","_slicedToArray","user","_useState","_useState2","likes","setLikes","likesRef","likesDoc","id","getLikes","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","data","wrap","_callee$","_context","prev","next","sent","docs","map","userId","likeId","stop","apply","arguments","addLike","_ref2","_callee2","newDoc","_callee2$","_context2","uid","postId","concat","_toConsumableArray","t0","console","log","removeLike","_ref3","_callee3","likeToDeleteQuery","likeToDeleteData","likeToDelete","_callee3$","_context3","filter","like","hasUserLiked","find","children","className","title","description","username","onClick","length"],"sources":["C:/Users/Riviane/Desktop/projectpt/Course-React-PT/src/main/post.tsx"],"sourcesContent":["import React, { useState } from 'react'\r\nimport { Post as Ipost} from './main'\r\nimport { addDoc, collection, query, where, getDocs, doc, deleteDoc } from 'firebase/firestore';\r\nimport { db, auth } from '../config/firebase';\r\nimport { useAuthState } from 'react-firebase-hooks/auth';\r\nimport { useEffect } from 'react';\r\nimport { number } from 'yup';\r\n\r\ninterface Props {\r\n    post: Ipost;\r\n}\r\n\r\ninterface Like {\r\nlikeId: string;\r\nuserId: string; \r\n}\r\nexport const Post = (props: Props) => {\r\n    const { post } = props;\r\n    const [user] = useAuthState(auth);\r\n\r\n    const [likes, setLikes] = useState <Like[] | null>(null);\r\n\r\n    const likesRef = collection(db, \"likes\");\r\n\r\n    const likesDoc = query(likesRef, where(\"postId\", \"==\", post.id ));\r\n\r\n    const getLikes = async () => {\r\n     const data =  await getDocs(likesDoc);\r\n     setLikes(data.docs.map((doc) =>({ userId: doc.data().userId, likeId: doc.id  })));\r\n\r\n    }\r\n\r\nconst addLike= async () => { \r\n    try {\r\n const newDoc = await addDoc(likesRef, {userId: user?.uid , postId: post.id })\r\nif(user){\r\nsetLikes((prev)=> prev ? [...prev, {userId: user.uid, likeId: newDoc.id} ] : [{userId: user.uid , likeId: newDoc.id}] )\r\n}; \r\n    } catch(err) {\r\n        console.log(err )\r\n    }\r\n}\r\n\r\n\r\n\r\nconst removeLike= async () => { \r\n    try {\r\n        const likeToDeleteQuery = query(likesRef, where(\"postId\", \"==\", post.id ), where(\"userId\", \"==\", user?.uid ));\r\n\r\nconst likeToDeleteData = await getDocs(likeToDeleteQuery)\r\nconst likeId = likeToDeleteData.docs[0].id\r\n\r\n        const likeToDelete = doc(db, \"likes\", likeId )\r\n\r\nawait deleteDoc(likeToDelete);\r\n if(user){\r\n setLikes((prev)=> prev && prev.filter((like)=> like.likeId !== likeId))\r\n }; \r\n    } catch(err) {\r\n        console.log(err )\r\n    }\r\n}\r\n\r\nconst hasUserLiked = likes?.find((like) => like.userId === user?.uid)\r\n\r\nuseEffect(() => {\r\n    getLikes()\r\n}, []);\r\n\r\n  return (\r\n    <div>\r\n   <div className=\"title\">\r\n    <h1> {post.title} </h1>\r\n   </div>\r\n\r\n        <div className=\"body\">\r\n            <p> {post.description} </p>\r\n        </div>\r\n\r\n        <div className=\"footer\">\r\n            <p> @{post.username}</p>\r\n            <button onClick={hasUserLiked ? removeLike : addLike }> {hasUserLiked ? <>&#128078;</> : <>&#128077; </> }</button>\r\n           { likes && <p> Likes : {likes?.length} </p> }\r\n        </div>\r\n    </div>\r\n  )\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}